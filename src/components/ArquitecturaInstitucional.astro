---
/* ArquitecturaInstitucional.astro - Calibración Quirúrgica: Paridad 20px/22px */
---

<section 
  id="Arquitectura" 
  class="relative bg-white m-0 p-0 overflow-hidden cursor-default"
  aria-labelledby="arch-section-label"
>
  
  <div class="relative z-10 max-w-[1440px] mx-auto px-7 md:px-16 lg:px-28 pt-24 pb-20 md:pt-40 md:pb-36 flex flex-col items-center">
    
    <span id="arch-section-label" class="label-museo-unified observer-element mb-24 lg:mb-32 opacity-0">
      ARQUITECTURA INSTITUCIONAL
    </span>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-16 lg:gap-8 mb-24 w-full">
      
      <a href="/la-firma#arquitectura-institucional" class="flex flex-col items-center text-center group observer-element no-underline outline-none opacity-0" aria-label="Saber más sobre nuestra Autoridad Técnica">
        <span class="label-mini-gold">Identidad</span>
        <div class="micro-stela-gold" aria-hidden="true"></div>
        <h3 class="pillar-title">Autoridad Técnica</h3>
      </a>

      <a href="/la-firma#arquitectura-institucional" class="flex flex-col items-center text-center group observer-element no-underline outline-none opacity-0" style="animation-delay: 0.3s;" aria-label="Saber más sobre nuestra Intervención Transversal">
        <span class="label-mini-gold">Alcance</span>
        <div class="micro-stela-gold" aria-hidden="true"></div>
        <h3 class="pillar-title">Intervención Transversal</h3>
      </a>

      <a href="/la-firma#arquitectura-institucional" class="flex flex-col items-center text-center group observer-element no-underline outline-none opacity-0" style="animation-delay: 0.5s;" aria-label="Saber más sobre nuestro Rigor Constitucional">
        <span class="label-mini-gold">Fundamento</span>
        <div class="micro-stela-gold" aria-hidden="true"></div>
        <h3 class="pillar-title">Rigor Constitucional</h3>
      </a>

    </div>

    <div class="w-full flex justify-end mb-24 lg:mb-32 observer-element opacity-0" style="animation-delay: 0.7s;">
      <a href="/la-firma#arquitectura-institucional" class="group no-underline outline-none" aria-label="Leer más sobre nuestra Arquitectura Institucional">
        <div class="cta-wrapper">
          <span class="read-more-box">
            LEER MÁS 
            <svg viewBox="0 0 32 16" class="arrow-svg-stylized" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M0 8H30M30 8L22 1M30 8L22 15" stroke="currentColor" stroke-width="1.2" stroke-linecap="square"/>
            </svg>
          </span>
        </div>
      </a>
    </div>

    <div class="flex flex-col items-center w-full max-w-3xl">
      <div class="closing-stela-vertical observer-element opacity-0" style="animation-delay: 0.9s;" aria-hidden="true"></div>
      <p class="final-phrase-institutional observer-element antialiased opacity-0" style="animation-delay: 1.1s;">
        La autoridad jurídica nace de la precisión con la que se estructura la decisión
      </p>
    </div>

  </div>
</section>

<script>
  // 1. LÓGICA DE APARICIÓN (Tu código original intacto)
  const observerOptions = { threshold: 0.15, rootMargin: "0px 0px -50px 0px" };
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll('.observer-element').forEach(el => observer.observe(el));

  // 2. EFECTO "DESLIZAMIENTO DE SEDA" (La Solución al Destello)
  // Verifica si la URL tiene un ancla (ej: #arquitectura-institucional)
  if (window.location.hash) {
    // A. Congela el scroll automático brusco del navegador
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    
    // B. Fuerza a empezar arriba del todo (elimina el salto feo)
    window.scrollTo(0, 0);

    // C. Espera un micro-momento a que cargue la estructura y... DESLIZA.
    window.addEventListener('load', () => {
      const targetId = window.location.hash.substring(1);
      const targetElement = document.getElementById(targetId);
      
      if (targetElement) {
        setTimeout(() => {
          targetElement.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
          });
        }, 100); // Pequeña pausa para asegurar suavidad
      }
    });
  }
</script>

<style>
  /* 1. TIPOGRAFÍA Y JERARQUÍA UNIFICADA (INTACTO) */
  .label-museo-unified, .label-mini-gold {
    color: var(--color-oro-tecnico);
    font-size: 12px;
    letter-spacing: 0.8em;
    text-transform: uppercase;
    font-weight: 700;
    text-align: center;
    display: block;
  }

  .label-mini-gold { opacity: 0.9; margin-bottom: 0.5rem; }

  /* AJUSTE MICROCÓPICO: Réplica exacta del formato de 'La Firma' */
  .pillar-title {
    font-family: 'ClashDisplay', sans-serif;
    font-weight: 700;
    font-size: 20px;
    letter-spacing: -0.025em;
    color: var(--color-bosque);
    line-height: 1.1;
    margin-top: 1.8rem;
    white-space: nowrap;
    -webkit-font-smoothing: antialiased;
  }

  @media (min-width: 768px) {
    .pillar-title {
      font-size: 22px;
    }
  }

  /* 2. ESTELAS AXIALES SEDOSAS (INTACTO) */
  .micro-stela-gold {
    width: 60px;
    height: 1.5px;
    background: linear-gradient(
      to right, 
      rgba(184, 148, 79, 0) 0%, 
      var(--color-oro-noble) 50%, 
      rgba(184, 148, 79, 0) 100%
    );
    margin-top: 1.2rem;
    opacity: 0.6;
    transition: width 0.8s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.5s ease;
    will-change: width;
  }

  .group:hover .micro-stela-gold,
  .group:focus-visible .micro-stela-gold { 
    width: 120px; 
    opacity: 1; 
  }

  .closing-stela-vertical {
    width: 1px;
    height: 65px;
    background: linear-gradient(to bottom, transparent, var(--color-oro-noble) 50%, transparent);
    margin-bottom: 2.5rem;
  }

  .final-phrase-institutional {
    font-family: 'ClashDisplay', sans-serif;
    color: var(--color-bosque);
    font-size: clamp(1rem, 1.6vw, 1.25rem);
    text-align: center;
    max-width: 650px;
    line-height: 1.5;
  }

  /* 3. BOTÓN LEER MÁS: SOLUCIÓN QUIRÚRGICA COMPLETA */
  .cta-wrapper { display: flex; justify-content: flex-end; width: 100%; }
  
  /* HIGIENE: Elimina el flash gris en iPhone al tocar el enlace padre */
  a.group {
    -webkit-tap-highlight-color: transparent;
  }

  .read-more-box {
    font-family: 'B612 Mono', monospace;
    font-size: 9px;
    letter-spacing: 0.2em;
    color: var(--color-oro-tecnico);
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.6rem 1.2rem 0.6rem 2.2rem;
    
    /* AISLAMIENTO: Protege el texto para que no sea tapado por el fondo */
    position: relative;
    isolation: isolate;
    
    /* TRANSICIÓN: Solo color, sin bloqueo de GPU */
    transition: color 0.4s ease;
    
    -webkit-font-smoothing: antialiased;
    white-space: nowrap; /* Evita que el texto se parta y se vea incompleto */
  }

  /* BARRA VERDE: Actualizada a Transform (Más fluida que Width) */
  .read-more-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    
    width: 100%; /* Ocupa todo el contenedor */
    height: 100%;
    background-color: var(--color-bosque);
    z-index: -1;
    
    /* ESTADO INICIAL: Escalado casi a cero (simula los 6px originales) */
    transform: scaleX(0.08); 
    transform-origin: left;
    transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1);
    
    /* ACELERACIÓN: Solo aquí es segura */
    will-change: transform;
  }

  /* --- INTERACCIÓN UNIFICADA (PC + IPHONE) --- */
  
  /* 1. Expansión (Hover + Focus + Active para respuesta inmediata) */
  .group:hover .read-more-box::before,
  .group:focus-visible .read-more-box::before,
  .group:active .read-more-box::before { 
    transform: scaleX(1); /* Expansión completa */
  }

  /* 2. Cambio de Color Texto */
  .group:hover .read-more-box,
  .group:focus-visible .read-more-box,
  .group:active .read-more-box { 
    color: white; 
  }

  /* 3. Limpieza de Borde Dorado (Solicitud Expresa) */
  .group:focus-visible {
    outline: none; 
  }

  /* FLECHA SVG: CORRECCIÓN DE ALTURA */
  .arrow-svg-stylized { 
    width: 32px; 
    
    /* CORRECCIÓN CRÍTICA: De 12px a 16px. 
       Esto evita que la flecha se vea "incompleta" o cortada. */
    height: 16px; 
    
    transition: transform 0.4s ease;
    flex-shrink: 0;
    
    /* SEGURIDAD DE CAPAS */
    position: relative;
    z-index: 2;
  }
  
  .group:hover .arrow-svg-stylized,
  .group:focus-visible .arrow-svg-stylized,
  .group:active .arrow-svg-stylized { 
    transform: translateX(8px); 
  }

  /* 4. ANIMACIONES (EFECTO SEDA 2.4s) (INTACTO) */
  .observer-element {
    opacity: 0;
    transform: translate3d(0, 40px, 0);
    will-change: transform, opacity;
  }

  .observer-element.is-visible {
    animation: revealSeda 2.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes revealSeda {
    to { opacity: 1; transform: translate3d(0, 0, 0); }
  }

  /* 5. OPTIMIZACIÓN MÓVIL (INTACTO) */
  @media (max-width: 768px) {
    .label-museo-unified, .label-mini-gold { font-size: 11px; letter-spacing: 0.4em; }
    .pillar-title { white-space: normal; padding: 0 1rem; font-size: 20px; }
    .closing-stela-vertical { height: 50px; }
    .final-phrase-institutional { padding: 0 20px; }
    
    /* Ajuste de padding para compensar tamaño */
    .read-more-box { font-size: 8.5px; padding-left: 1.8rem; }
    
    .micro-stela-gold { width: 40px; }
  }

  @media (prefers-reduced-motion: reduce) {
    .observer-element { opacity: 1 !important; transform: none !important; animation: none !important; }
  }

  /* 6. SUAVIZADO DE NAVEGACIÓN (EFECTO ANTI-SALTO) */
  :global(html) {
    scroll-behavior: smooth;
  }

</style>