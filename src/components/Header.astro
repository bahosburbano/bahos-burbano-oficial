---
// src/components/Header.astro
import LogoFirma from './LogoFirma.astro';

const navItems = [
  { name: 'La Firma', slug: 'la-firma' }, 
  { 
    name: 'Áreas de Práctica', 
    slug: 'areas-de-practica', 
    submenu: [
      { name: 'Derecho Público <span class="amp">&</span> Gobernanza Institucional', url: '/areas/publico-y-gobernanza' },
      { name: 'Derecho Corporativo <span class="amp">&</span> Control Regulatorio', url: '/areas/corporativo-y-control' },
      { name: 'Derecho Sanitario <span class="amp">&</span> Responsabilidad Médica', url: '/areas/sanitario-y-responsabilidad' },
      { name: 'Derecho Internacional <span class="amp">&</span> Movilidad Jurídica', url: '/areas/internacional-y-movilidad' }
    ]
  },
  { name: 'Nuestro Equipo', slug: 'talento' },
  { name: 'Contáctenos', slug: 'contactenos' } 
];

// Estilo común para los enlaces (para no repetir código en el render condicional)
/* Añadimos py-4 (padding vertical) para que el área de clic sea el doble de grande */
// Variable única y blindada para todos los enlaces del menú
const navLinkClass = "nav-link text-[13px] tracking-[0.3em] font-medium uppercase text-[var(--color-bosque)] flex items-center gap-1 cursor-pointer py-4 outline-none focus-visible:text-[var(--color-oro-noble)]";
---

<header id="main-header" class="fixed top-0 left-0 w-full z-50 px-6 md:px-12 py-6 flex justify-between items-center bg-white">
  
  <div class="flex-shrink-0">
    <a href="/" class="transition-opacity duration-500 hover:opacity-80">
      <LogoFirma />
    </a>
  </div>
  
  <nav class="hidden md:flex items-center gap-14">
    {navItems.map((item) => (
      <div class="relative group">
        
        {item.submenu ? (
          /* CASO 1: Es un botón de menú con inteligencia para ciegos */
<a 
  role="button" 
  aria-haspopup="true" 
  aria-expanded="false" 
  aria-controls="submenu-areas"
  class={navLinkClass}
  tabindex="0"
>
  <span class="relative">
    {item.name}
    <span class="underline-gold"></span>
  </span>
  <svg class="submenu-arrow w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
    <path d="M20 9l-8 5-8-5h16z" />
  </svg>
</a>
        ) : (
          /* CASO 2: Es un enlace normal (Con href) */
          <a href={`/${item.slug}`} class={navLinkClass}>
            <span class="relative">
              {item.name}
              <span class="underline-gold"></span>
            </span>
          </a>
        )}

        {item.submenu && (
          <div class="absolute top-full -left-8 pt-6 
                      pointer-events-none group-hover:pointer-events-auto group-focus-within:pointer-events-auto group-focus-within:opacity-100 group-focus-within:translate-y-0 
                      opacity-0 group-hover:opacity-100 
                      translate-y-2 group-hover:translate-y-0 
                      transition-all duration-500 ease-out">
            <div class="bg-[#FFFFFF] shadow-[0_20px_50px_rgba(0,0,0,0.15)] p-8 min-w-[420px] space-y-5">
              {item.submenu.map((sub) => (
                <a href={sub.url} 
   class="sub-link block text-[13px] uppercase tracking-[0.2em] text-[var(--color-bosque)] transition-all duration-300 py-2 hover:pl-2" 
   set:html={sub.name}>
</a>
              ))}
            </div>
          </div>
        )}
      </div>
    ))}
  </nav>

  <button id="mobile-menu-btn" class="md:hidden flex flex-col items-end gap-2 z-50 group" aria-label="Abrir menú">
    <span class="w-8 h-[1px] bg-[#0C382E] transition-all duration-500 group-hover:w-6"></span>
    <span class="w-5 h-[1px] bg-[#0C382E] transition-all duration-500 group-hover:w-8"></span>
  </button>

  <div id="mobile-menu" class="fixed inset-0 bg-white translate-x-full transition-transform duration-700 ease-[cubic-bezier(0.23,1,0.32,1)] z-40 flex flex-col justify-center px-12">
    <nav class="flex flex-col gap-6">
  {navItems.map((item) => (
    <div class="flex flex-col gap-4">
      <a href={item.submenu ? undefined : `/${item.slug}`} 
         class="mobile-nav-link text-[22px] tracking-[0.15em] font-bold uppercase text-[var(--color-bosque)]">
        {item.name}
      </a>
      {item.submenu && (
        <div class="flex flex-col gap-4 pl-4 border-l border-[var(--color-oro-noble)]/30">
          {item.submenu.map((sub) => (
            <a href={sub.url} class="text-[14px] uppercase tracking-[0.2em] text-[var(--color-bosque)]/70" set:html={sub.name} />
          ))}
        </div>
      )}
    </div>
  ))}
</nav>
  </div>

</header>

<script>
const mobileBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const body = document.body;
  let isMenuOpen = false;

  // 1. LÓGICA DEL MENÚ MÓVIL
  mobileBtn?.addEventListener('click', () => {
    isMenuOpen = !isMenuOpen;
    mobileMenu?.classList.toggle('translate-x-full');
    mobileMenu?.classList.toggle('translate-x-0');
    body.style.overflow = isMenuOpen ? 'hidden' : '';

    const lines = mobileBtn.querySelectorAll('span');
    if (isMenuOpen) {
      lines[0].style.transform = 'translateY(4.5px) rotate(45deg)';
      lines[1].style.transform = 'translateY(-4.5px) rotate(-45deg)';
      lines[1].style.width = '32px';
    } else {
      lines[0].style.transform = 'none';
      lines[1].style.transform = 'none';
      lines[1].style.width = '20px';
    }
  });

  // 2. INTELIGENCIA DE SUBMENÚS (Desktop & Accesibilidad)
  const menuButtons = document.querySelectorAll('a[role="button"]');

  menuButtons.forEach(button => {
    // Evita que el click recargue la página
    button.addEventListener('click', e => e.preventDefault());

    const groupContainer = button.closest('.group');

    if (groupContainer) {
      // Eventos de Mouse (Para el estado visual y ARIA)
      groupContainer.addEventListener('mouseenter', () => button.setAttribute('aria-expanded', 'true'));
      groupContainer.addEventListener('mouseleave', () => button.setAttribute('aria-expanded', 'false'));
      
      // Eventos de Teclado (Para usuarios con discapacidad)
      button.addEventListener('focus', () => button.setAttribute('aria-expanded', 'true'));
      button.addEventListener('blur', () => button.setAttribute('aria-expanded', 'false'));
    }
  });
</script>

<style is:global>
  .amp {
    font-family: 'B612 Mono', monospace;
    font-weight: 400;
    margin: 0 0.2em;
  }
</style>

<style>
  /* CORRECCIÓN 2: Eliminado will-change permanente para evitar flickering en GPU */
  #main-header {
    transition-property: background-color, box-shadow;
    transition-duration: 0.4s;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  nav { 
    font-family: 'ClashDisplay', sans-serif; 
  }

  .nav-link {
  transition: color 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  /* Asegura que el área de la manito sea total */
  display: flex; 
  align-items: center;
}

/* El color cambia cuando el cursor entra al grupo, no solo al texto */
.group:hover .nav-link {
  color: var(--color-oro-noble);
}

  .underline-gold {
    content: '';
    position: absolute;
    bottom: -6px;
    left: 50%;
    width: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent 0%, var(--color-oro-noble) 30%, var(--color-oro-noble) 70%, transparent 100%);
    opacity: 0.9;
    transition: width 0.4s cubic-bezier(0.22, 1, 0.36, 1), left 0.4s cubic-bezier(0.22, 1, 0.36, 1);
  }

  .group:hover .underline-gold {
    width: 100%;
    left: 0;
  }

  .submenu-arrow {
    color: #0C382E;
    opacity: 0.8;
    margin-top: 1px;
    margin-left: -2px;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), color 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .group:hover .submenu-arrow {
    opacity: 1;
    transform: rotate(180deg);
    color: var(--color-oro-noble);
  }

  .sub-link:hover {
    color: var(--color-oro-noble) !important;
    transform: translateX(4px);
  }

  .mobile-nav-link {
    font-family: 'ClashDisplay', sans-serif;
    transition: color 0.4s ease, padding-left 0.4s ease;
    padding-bottom: 1rem;
  }

  .mobile-nav-link:hover {
    color: var(--color-oro-noble);
    padding-left: 10px;
  }
  
  #mobile-menu-btn {
    position: relative;
    z-index: 100;
  }
</style>